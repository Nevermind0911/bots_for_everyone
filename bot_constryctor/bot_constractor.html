<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Telegram-–±–æ—Ç–∞ | TG Bots Studio</title>
  <meta name="description" content="–°–æ–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ ‚Äî –±–µ–∑ –∫–æ–¥–∞.">

  <style>
    /* === –¢–≤–æ–π —Å—Ç–∏–ª—å + —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ === */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.5;
      color: #0f172a;
      background-color: #f3f4f6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 20;
      background-color: rgba(15, 23, 42, 0.96);
      backdrop-filter: blur(10px);
      color: #e5e7eb;
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 60px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .logo-mark { font-size: 20px; }
    .logo-text { font-size: 16px; }

    .nav { display: flex; align-items: center; gap: 16px; }
    .nav-link {
      font-size: 14px;
      opacity: 0.85;
      padding: 6px 10px;
      border-radius: 999px;
      transition: background 0.15s;
    }
    .nav-link:hover { background: rgba(148,163,184,0.15); opacity: 1; }
    .nav-link-primary {
      background: #22c55e;
      color: #052e16;
      font-weight: 600;
    }
    .nav-link-primary:hover { background: #16a34a; }

    /* Hero */
    .hero {
      padding: 60px 0 40px;
      background: radial-gradient(circle at top left, #1d4ed8 0, #0f172a 40%, #020617 100%);
      color: #e5e7eb;
    }

    .hero-inner {
      text-align: center;
    }

    .hero-text h1 {
      font-size: 36px;
      line-height: 1.2;
      margin-bottom: 16px;
    }

    .accent { color: #22c55e; }

    .hero-subtitle {
      font-size: 18px;
      opacity: 0.95;
      margin: 0 auto 28px;
      max-width: 700px;
    }

    /* –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä */
    .constructor-section {
      padding: 20px 0 60px;
    }

    .constructor-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
    }

    .constructor-container {
      display: flex;
      gap: 20px;
      height: 650px;
    }

    /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî –±–ª–æ–∫–∏ */
    .blocks-panel {
      width: 240px;
      background: #f9fafb;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #e2e8f0;
    }

    .block-category {
      margin-bottom: 20px;
    }

    .block-category-title {
      font-size: 14px;
      font-weight: 600;
      color: #334155;
      margin-bottom: 10px;
    }

    .block-item {
      background: white;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      cursor: grab;
      border: 1px solid #e2e8f0;
      display: flex;
      align-items: center;
      gap: 10px;
      user-select: none;
    }

    .block-icon {
      font-size: 16px;
    }

    /* –†–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å */
    .workspace {
      flex: 1;
      background: #f8fafc;
      border-radius: 12px;
      position: relative;
      overflow: auto;
      border: 1px solid #e2e8f0;
    }

    .step-block {
      position: absolute;
      background: white;
      border-radius: 12px;
      padding: 16px;
      min-width: 240px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      border: 1px solid #e2e8f0;
      cursor: move;
      user-select: none;
      z-index: 1;
    }

    .step-block.selected {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .step-content {
      font-size: 13px;
      line-height: 1.5;
      color: #334155;
      padding: 8px 0;
    }

    .step-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #6b7280;
    }

    .step-footer button {
      background: none;
      border: none;
      cursor: pointer;
      color: #6b7280;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.1s;
    }

    .step-footer button:hover {
      background: #e2e8f0;
    }

    /* –°–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ */
    .connection-line {
      position: absolute;
      pointer-events: none;
      z-index: 0;
      stroke: #94a3b8;
      stroke-width: 2;
      fill: none;
    }

    /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä */
    .editor-panel {
      width: 300px;
      background: white;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #e2e8f0;
    }

    .editor-header {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #1e293b;
    }

    .editor-tab {
      background: #f1f5f9;
      padding: 8px 12px;
      border-radius: 6px;
      margin-right: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
    }

    .editor-tab.active {
      background: #22c55e;
      color: white;
    }

    .editor-content {
      margin-top: 16px;
    }

    .editor-field {
      margin-bottom: 16px;
    }

    .editor-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 6px;
      color: #334155;
    }

    .editor-input,
    .editor-textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      font-size: 14px;
    }

    .editor-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .editor-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .editor-button {
      width: 100%;
      padding: 10px;
      background: #22c55e;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.1s;
    }

    .editor-button:hover {
      background: #16a34a;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .btn-primary {
      background-color: #22c55e;
      color: #052e16;
      border: none;
    }

    .btn-primary:hover {
      background-color: #16a34a;
      transform: translateY(-1px);
    }

    /* Footer */
    .footer {
      border-top: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 16px 0;
      font-size: 13px;
      color: #6b7280;
    }

    .footer-inner {
      display: flex;
      justify-content: space-between;
    }

    @media (max-width: 1024px) {
      .constructor-container { flex-direction: column; height: auto; }
      .blocks-panel, .editor-panel { width: 100%; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="container header-inner">
      <div class="logo">
        <span class="logo-mark">ü§ñ</span>
        <span class="logo-text">TG Bots Studio</span>
      </div>
      <nav class="nav">
        <a href="/" class="nav-link">–¢–∞—Ä–∏—Ñ—ã</a>
        <a href="constructor.html" class="nav-link nav-link-primary">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-inner">
      <h1>–°–æ–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞ <span class="accent">–≤–∏–∑—É–∞–ª—å–Ω–æ</span></h1>
      <p class="hero-subtitle">
        –ù–∞–∑—ã–≤–∞–π—Ç–µ –±–ª–æ–∫–∏ –∫–∞–∫ —É–≥–æ–¥–Ω–æ ‚Üí –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ª–æ–≥–∏–∫—É ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ ‚Üí –ø–æ–ª—É—á–∏—Ç–µ –±–æ—Ç–∞ –∑–∞ 3‚Äì7 –¥–Ω–µ–π.
      </p>
    </div>
  </section>

  <!-- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä -->
  <section class="constructor-section">
    <div class="container">
      <div class="constructor-card">
        <div class="constructor-container">
          <!-- –ë–ª–æ–∫–∏ -->
          <div class="blocks-panel">
            <div class="block-category">
              <div class="block-category-title">–ó–∞–ø—É—Å–∫</div>
              <div class="block-item" data-type="command" draggable="true">
                <span class="block-icon">‚ñ∂Ô∏è</span> –ö–æ–º–∞–Ω–¥–∞ /start
              </div>
            </div>
            <div class="block-category">
              <div class="block-category-title">–î–µ–π—Å—Ç–≤–∏—è</div>
              <div class="block-item" data-type="message" draggable="true">
                <span class="block-icon">üí¨</span> –°–æ–æ–±—â–µ–Ω–∏–µ
              </div>
              <div class="block-item" data-type="buttons" draggable="true">
                <span class="block-icon">üîò</span> –ö–Ω–æ–ø–∫–∏
              </div>
              <div class="block-item" data-type="media" draggable="true">
                <span class="block-icon">üñºÔ∏è</span> –§–æ—Ç–æ/–í–∏–¥–µ–æ/–§–∞–π–ª
              </div>
              <div class="block-item" data-type="collect" draggable="true">
                <span class="block-icon">üìù</span> –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
              </div>
              <div class="block-item" data-type="payment" draggable="true">
                <span class="block-icon">üí≥</span> –û–ø–ª–∞—Ç–∞
              </div>
              <div class="block-item" data-type="delay" draggable="true">
                <span class="block-icon">‚è±Ô∏è</span> –ó–∞–¥–µ—Ä–∂–∫–∞
              </div>
              <div class="block-item" data-type="condition" draggable="true">
                <span class="block-icon">üîÄ</span> –£—Å–ª–æ–≤–∏–µ
              </div>
            </div>
          </div>

          <!-- –†–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å -->
          <div class="workspace" id="workspace">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏ –∏ –ª–∏–Ω–∏–∏ –±—É–¥—É—Ç —Å—é–¥–∞ -->
          </div>

          <!-- –†–µ–¥–∞–∫—Ç–æ—Ä -->
          <div class="editor-panel" id="editor">
            <div class="editor-header">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫</div>
            <p style="font-size: 13px; color: #64748b;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –±–ª–æ–∫ –≤ —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ.</p>
          </div>
        </div>

        <div style="text-align: center; margin-top: 24px;">
          <button id="sendToAdminBtn" class="btn btn-primary">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –º–Ω–µ –≤ Telegram
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container footer-inner">
      <span>¬© 2025 TG Bots Studio</span>
      <a href="https://t.me/your_username" target="_blank">–°–≤—è–∑–∞—Ç—å—Å—è –≤ Telegram</a>
    </div>
  </footer>

  <script>
    let selectedBlock = null;
    let blocks = [];
    let connections = [];
    let blockIdCounter = 1;

    const workspace = document.getElementById('workspace');
    const editor = document.getElementById('editor');

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞
    function addBlock(type, x = 100, y = 100, data = {}) {
      const id = 'block-' + blockIdCounter++;
      let title = '', icon = '', defaultContent = '';

      switch (type) {
        case 'command':
          title = '–ö–æ–º–∞–Ω–¥–∞ /start';
          icon = '‚ñ∂Ô∏è';
          defaultContent = '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–ª–æ–∫.';
          break;
        case 'message':
          title = '–°–æ–æ–±—â–µ–Ω–∏–µ';
          icon = 'üí¨';
          defaultContent = '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.';
          break;
        case 'buttons':
          title = '–ö–Ω–æ–ø–∫–∏';
          icon = 'üîò';
          defaultContent = '["–î–∞", "–ù–µ—Ç"]';
          break;
        case 'media':
          title = '–ú–µ–¥–∏–∞';
          icon = 'üñºÔ∏è';
          defaultContent = 'https://example.com/photo.jpg';
          break;
        case 'collect':
          title = '–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö';
          icon = 'üìù';
          defaultContent = '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:';
          break;
        case 'payment':
          title = '–û–ø–ª–∞—Ç–∞';
          icon = 'üí≥';
          defaultContent = 'https://pay.example.com';
          break;
        case 'delay':
          title = '–ó–∞–¥–µ—Ä–∂–∫–∞';
          icon = '‚è±Ô∏è';
          defaultContent = '5';
          break;
        case 'condition':
          title = '–£—Å–ª–æ–≤–∏–µ';
          icon = 'üîÄ';
          defaultContent = '–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç == "–î–∞"';
          break;
      }

      const block = {
        id,
        type,
        displayName: title, // ‚Üê –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å
        title, // ‚Üê –∏—Å—Ö–æ–¥–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–¥–ª—è —Ç–∏–ø–∞)
        icon,
        content: data.content || defaultContent,
        x,
        y,
        next: null
      };
      blocks.push(block);

      renderBlock(block);
      return block;
    }

    function renderBlock(block) {
      const el = document.createElement('div');
      el.className = 'step-block';
      el.id = block.id;
      el.style.left = block.x + 'px';
      el.style.top = block.y + 'px';
      el.innerHTML = `
        <div class="step-header">
          <span>${block.icon}</span>
          <span>${block.displayName}</span>
        </div>
        <div class="step-content">${block.content}</div>
        <div class="step-footer">
          <span>–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Üí</span>
          <button class="delete-btn">√ó</button>
        </div>
      `;

      // –í—ã–±–æ—Ä –±–ª–æ–∫–∞
      el.addEventListener('click', (e) => {
        if (selectedBlock) document.getElementById(selectedBlock).classList.remove('selected');
        selectedBlock = block.id;
        el.classList.add('selected');
        openEditor(block);
        e.stopPropagation();
      });

      // –£–¥–∞–ª–µ–Ω–∏–µ
      el.querySelector('.delete-btn').addEventListener('click', () => {
        el.remove();
        blocks = blocks.filter(b => b.id !== block.id);
        connections = connections.filter(c => c.from !== block.id && c.to !== block.id);
        redrawConnections();
        selectedBlock = null;
        editor.innerHTML = '<div class="editor-header">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫</div><p style="font-size:13px;color:#64748b;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –±–ª–æ–∫...</p>';
      });

      // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
      let isDragging = false, offsetX, offsetY;
      el.addEventListener('mousedown', (e) => {
        if (e.target.classList.contains('delete-btn')) return;
        isDragging = true;
        offsetX = e.clientX - el.getBoundingClientRect().left;
        offsetY = e.clientY - el.getBoundingClientRect().top;
        el.style.zIndex = '1000';
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const rect = workspace.getBoundingClientRect();
        let newX = e.clientX - rect.left - offsetX;
        let newY = e.clientY - rect.top - offsetY;
        newX = Math.max(0, Math.min(newX, rect.width - el.offsetWidth));
        newY = Math.max(0, Math.min(newY, rect.height - el.offsetHeight));
        el.style.left = newX + 'px';
        el.style.top = newY + 'px';
        const b = blocks.find(b => b.id === block.id);
        if (b) { b.x = newX; b.y = newY; }
        redrawConnections();
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        if (el) el.style.zIndex = '';
      });

      workspace.appendChild(el);

      if (block.next) {
        drawConnection(block.id, block.next);
      }
    }

    function drawConnection(fromId, toId) {
      const from = document.getElementById(fromId);
      const to = document.getElementById(toId);
      if (!from || !to) return;

      const fromRect = from.getBoundingClientRect();
      const toRect = to.getBoundingClientRect();
      const workspaceRect = workspace.getBoundingClientRect();

      const startX = fromRect.left + fromRect.width / 2 - workspaceRect.left;
      const startY = fromRect.bottom - workspaceRect.top;
      const endX = toRect.left + toRect.width / 2 - workspaceRect.left;
      const endY = toRect.top - workspaceRect.top;

      const line = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      line.setAttribute('class', 'connection-line');
      line.setAttribute('width', '100%');
      line.setAttribute('height', '100%');
      line.innerHTML = `<line x1="${startX}" y1="${startY}" x2="${endX}" y2="${endY}" />`;

      workspace.appendChild(line);
      connections.push({ from: fromId, to: toId, element: line });
    }

    function redrawConnections() {
      connections.forEach(c => {
        if (c.element) c.element.remove();
      });
      connections = [];

      blocks.forEach(block => {
        if (block.next) {
          drawConnection(block.id, block.next);
        }
      });
    }

    function openEditor(block) {
      let editorHTML = `
        <div class="editor-header">${block.icon} ${block.title}</div>
        <div class="editor-field">
          <label class="editor-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ (–¥–ª—è –≤–∞—Å)</label>
          <input class="editor-input" id="edit-display-name" value="${block.displayName}">
        </div>
      `;

      switch (block.type) {
        case 'command':
          const [cmd = '/start', text = '–ü—Ä–∏–≤–µ—Ç!'] = block.content.split(':', 2);
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–ö–æ–º–∞–Ω–¥–∞</label>
              <input class="editor-input" id="edit-command" value="${cmd}">
            </div>
            <div class="editor-field">
              <label class="editor-label">–¢–µ–∫—Å—Ç</label>
              <textarea class="editor-textarea" id="edit-content">${text}</textarea>
            </div>
          `;
          break;
        case 'message':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–¢–µ–∫—Å—Ç</label>
              <textarea class="editor-textarea" id="edit-content">${block.content}</textarea>
            </div>
          `;
          break;
        case 'buttons':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–ö–Ω–æ–ø–∫–∏ (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
              <textarea class="editor-textarea" id="edit-buttons">${block.content.replace(/\["|"\]/g, '').replace(/",\s?"/g, '\n')}</textarea>
            </div>
            <div class="editor-checkbox">
              <input type="checkbox" id="edit-inline" ${block.content.includes('Inline') ? 'checked' : ''}>
              <label for="edit-inline">–ò–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ (—Å—Å—ã–ª–∫–∏)</label>
            </div>
          `;
          break;
        case 'media':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">URL –∏–ª–∏ file_id</label>
              <input class="editor-input" id="edit-media-url" value="${block.content}">
            </div>
            <div class="editor-field">
              <label class="editor-label">–¢–∏–ø</label>
              <select class="editor-input" id="edit-media-type">
                <option value="photo">–§–æ—Ç–æ</option>
                <option value="video">–í–∏–¥–µ–æ</option>
                <option value="document">–î–æ–∫—É–º–µ–Ω—Ç</option>
              </select>
            </div>
          `;
          break;
        case 'collect':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–í–æ–ø—Ä–æ—Å</label>
              <input class="editor-input" id="edit-collect-question" value="${block.content}">
            </div>
            <div class="editor-field">
              <label class="editor-label">–ò–º—è –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, email)</label>
              <input class="editor-input" id="edit-collect-field" value="user_name">
            </div>
          `;
          break;
        case 'payment':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É</label>
              <input class="editor-input" id="edit-payment-url" value="${block.content}">
            </div>
            <div class="editor-field">
              <label class="editor-label">–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏</label>
              <input class="editor-input" id="edit-payment-text" value="–û–ø–ª–∞—Ç–∏—Ç—å">
            </div>
          `;
          break;
        case 'delay':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–ó–∞–¥–µ—Ä–∂–∫–∞ (—Å–µ–∫—É–Ω–¥)</label>
              <input class="editor-input" type="number" id="edit-delay-seconds" value="${block.content}">
            </div>
          `;
          break;
        case 'condition':
          editorHTML += `
            <div class="editor-field">
              <label class="editor-label">–£—Å–ª–æ–≤–∏–µ</label>
              <input class="editor-input" id="edit-condition" value="${block.content}">
            </div>
            <div style="font-size:12px;color:#6b7280;margin-top:4px;">
              –ü—Ä–∏–º–µ—Ä: "–æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç '–∫—É–ø–∏—Ç—å'"
            </div>
          `;
          break;
      }

      editorHTML += `
        <div class="editor-field">
          <label class="editor-label">–°–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫</label>
          <select class="editor-input" id="edit-next-block">
            <option value="">–ù–µ—Ç</option>
            ${blocks.map(b => `<option value="${b.id}" ${block.next === b.id ? 'selected' : ''}>${b.displayName}</option>`).join('')}
          </select>
        </div>
        <button class="editor-button" id="save-edit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      `;

      editor.innerHTML = editorHTML;

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      document.getElementById('save-edit').addEventListener('click', () => {
        block.displayName = document.getElementById('edit-display-name').value.trim() || block.title;

        let newContent = '';
        switch (block.type) {
          case 'command':
            const cmd = document.getElementById('edit-command').value.trim();
            const text = document.getElementById('edit-content').value.trim();
            newContent = `${cmd}:${text}`;
            break;
          case 'message':
            newContent = document.getElementById('edit-content').value;
            break;
          case 'buttons':
            const btns = document.getElementById('edit-buttons').value.split('\n').filter(b => b.trim()).map(b => `"${b.trim()}"`).join(', ');
            newContent = `[${btns}]`;
            break;
          case 'media':
            newContent = document.getElementById('edit-media-url').value.trim();
            break;
          case 'collect':
            newContent = document.getElementById('edit-collect-question').value.trim();
            break;
          case 'payment':
            newContent = document.getElementById('edit-payment-url').value.trim();
            break;
          case 'delay':
            newContent = document.getElementById('edit-delay-seconds').value;
            break;
          case 'condition':
            newContent = document.getElementById('edit-condition').value.trim();
            break;
        }

        block.content = newContent;
        document.querySelector(`#${block.id} .step-header span:last-child`).textContent = block.displayName;
        document.querySelector(`#${block.id} .step-content`).textContent = newContent;

        const nextId = document.getElementById('edit-next-block').value;
        block.next = nextId;
        redrawConnections();
      });
    }

    // Drag & Drop
    document.querySelectorAll('.block-item').forEach(item => {
      item.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('type', item.dataset.type);
      });
    });

    workspace.addEventListener('dragover', (e) => e.preventDefault());
    workspace.addEventListener('drop', (e) => {
      e.preventDefault();
      const type = e.dataTransfer.getData('type');
      const rect = workspace.getBoundingClientRect();
      const x = e.clientX - rect.left - 120;
      const y = e.clientY - rect.top - 60;
      addBlock(type, x, y);
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞
    document.getElementById('sendToAdminBtn').addEventListener('click', () => {
      if (blocks.length === 0) {
        alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±–ª–æ–∫!');
        return;
      }
      let text = '–°—Ü–µ–Ω–∞—Ä–∏–π –±–æ—Ç–∞:\n\n';
      blocks.forEach((b, i) => {
        text += `${i + 1}. ${b.displayName}: "${b.content}"\n`;
        if (b.next) {
          const next = blocks.find(bl => bl.id === b.next);
          if (next) text += `   ‚Üí –°–ª–µ–¥—É—é—â–∏–π: ${next.displayName}\n`;
        }
      });
      text += '\n–ó–∞–ø—Ä–æ—Å –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.';
      window.open(`https://t.me/your_username?text=${encodeURIComponent(text)}`, '_blank');
    });
  </script>

</body>
</html>